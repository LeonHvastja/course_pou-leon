"0","library(tidyr)"
"0","set.seed(1)"
"0","nsamps <- 100000"
"0","find_p <- function (mu, r) {"
"0","  return (10 / (r + 10))"
"0","}"
"0","r <- c(1,2,10,20)"
"0","p <- find_p(10, r)"
"0","sigma <- rep(sqrt(p*r / (1 - p)^2), each = nsamps)"
"0","samps <- cbind(""r=1""  = rnbinom(nsamps, size = r[1], prob = 1 - p[1]),"
"0","               ""r=2""  = rnbinom(nsamps, size = r[2], prob = 1 - p[2]),"
"0","               ""r=4""  = rnbinom(nsamps, size = r[3], prob = 1 - p[3]),"
"0","               ""r=20"" = rnbinom(nsamps, size = r[4], prob = 1 - p[4]))"
"0","gsamps <- gather(as.data.frame(samps))"
"0","iw     <- (gsamps$value > sigma + 10) | (gsamps$value < sigma - 10)"
"0","ggplot(gsamps, aes(x = value, fill = iw)) +"
"0","  geom_bar() +"
"0","  # geom_density() +"
"0","  facet_wrap(~ key)"
